"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([[592],{5058:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var s=t(4848),i=t(8453);const r={sidebar_position:1},o="proseMirror guide \u7ffb\u8b6f",a={id:"prosemirror/guide",title:"proseMirror guide \u7ffb\u8b6f",description:"\u81ea\u5df1\u7684\u6574\u7406",source:"@site/docs/prosemirror/guide.md",sourceDirName:"prosemirror",slug:"/prosemirror/guide",permalink:"/blog/docs/prosemirror/guide",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/prosemirror/guide.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"ProseMirror",permalink:"/blog/docs/category/prosemirror"},next:{title:"React \u5b78\u7fd2\u7b46\u8a18",permalink:"/blog/docs/category/react-\u5b78\u7fd2\u7b46\u8a18"}},c={},l=[{value:"\u81ea\u5df1\u7684\u6574\u7406",id:"\u81ea\u5df1\u7684\u6574\u7406",level:2},{value:"plugin / node view / decoration \u7684\u5dee\u7570",id:"plugin--node-view--decoration-\u7684\u5dee\u7570",level:3},{value:"\u4ecb\u7d39",id:"\u4ecb\u7d39",level:2},{value:"transactions",id:"transactions",level:3},{value:"plugins",id:"plugins",level:3},{value:"commands",id:"commands",level:3},{value:"content",id:"content",level:3},{value:"Documents",id:"documents",level:2},{value:"Structure",id:"structure",level:3},{value:"Document transformations",id:"document-transformations",level:2},{value:"steps",id:"steps",level:3},{value:"Transform",id:"transform",level:3},{value:"Mapping",id:"mapping",level:3},{value:"Rebasing",id:"rebasing",level:3},{value:"The editor state",id:"the-editor-state",level:2},{value:"Selection",id:"selection",level:3},{value:"Transaction",id:"transaction",level:3},{value:"Plugins",id:"plugins-1",level:3},{value:"metadata",id:"metadata",level:4},{value:"The View Component",id:"the-view-component",level:2},{value:"Data flow",id:"data-flow",level:3},{value:"Props",id:"props",level:3},{value:"Decorations",id:"decorations",level:3},{value:"Node View",id:"node-view",level:3},{value:"commands",id:"commands-1",level:2},{value:"\u53c3\u8003\u6587\u7ae0",id:"\u53c3\u8003\u6587\u7ae0",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"prosemirror-guide-\u7ffb\u8b6f",children:"proseMirror guide \u7ffb\u8b6f"})}),"\n",(0,s.jsx)(n.h2,{id:"\u81ea\u5df1\u7684\u6574\u7406",children:"\u81ea\u5df1\u7684\u6574\u7406"}),"\n",(0,s.jsx)(n.h3,{id:"plugin--node-view--decoration-\u7684\u5dee\u7570",children:"plugin / node view / decoration \u7684\u5dee\u7570"}),"\n",(0,s.jsx)(n.p,{children:"plugin \u7528\u4f86\u6539\u8b8a\u7de8\u8f2f\u5668\u7684\u6587\u6a94\uff0c\u53ef\u4ee5\u52a0\u4e00\u4e9b\u6309\u9375\u7d81\u5b9a\u3001\u4fee\u6539\u7de8\u8f2f\u5668\u7684\u72c0\u614b...\nnode view \u70ba\u7279\u5b9a\u7bc0\u9ede\u64f4\u5c55\u81ea\u5b9a\u7fa9\u7684\u7d50\u69cb\ndecoration \u5c07\u6587\u6a94\u6dfb\u52a0\u8996\u89ba\u6548\u679c"}),"\n",(0,s.jsx)(n.h2,{id:"\u4ecb\u7d39",children:"\u4ecb\u7d39"}),"\n",(0,s.jsx)(n.p,{children:"ProseMirror \u63d0\u4f9b\u4e86\u80fd\u5b8c\u6210\u6587\u5b57\u7de8\u8f2f\u5668\u7684\u4e00\u7cfb\u5217\u5de5\u5177\u8207\u6982\u5ff5\u3002"}),"\n",(0,s.jsx)(n.p,{children:"PM \u7684\u4e3b\u8981\u539f\u5247\u662f\u8b93 code \u80fd\u6709\u5b8c\u5168\u5c0d\u65bc document \u7684\u638c\u63a7\uff0c\u80fd\u5b8c\u5168\u77e5\u9053\u767c\u751f\u4ec0\u9ebc\u4e8b\u3002document \u4e0d\u662f html\uff0c\u662f\u6307\u4e00\u500b\u81ea\u8a02\u7684\u8cc7\u6599\u7d50\u69cb\uff0c\u9019\u500b\u7d50\u69cb\u53ef\u4ee5\u898f\u7bc4\u4ec0\u9ebc\u6a23\u7684 DOM \u53ef\u4ee5\u5305\u542b\u5728\u7d50\u69cb\u4e2d\uff0c\u6240\u6709\u7684\u66f4\u65b0\u90fd\u7d93\u904e\u4e00\u500b\u7279\u5b9a\u7684\u9ede\uff0c\u8b93\u4f60\u53ef\u4ee5\u89c0\u5bdf\u8207\u56de\u61c9\u3002"}),"\n",(0,s.jsx)(n.p,{children:"core module \u7684\u8a2d\u8a08\u662f\u4ee5\u6a21\u7d44\u5316\u8207\u5ba2\u88fd\u5316\u7684\u80fd\u529b\u70ba\u4e3b\u8981\u8003\u91cf\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u6709 4 \u500b\u91cd\u8981\u7684 module\uff0c\u9032\u884c\u4efb\u4f55\u7de8\u8f2f\u90fd\u9700\u8981\u9019\u4e9b\u3002\u9084\u6709\u4e00\u4e9b\u984d\u5916\u7684\u63d2\u4ef6\uff0c\u4f46\u53ef\u4ee5\u5ffd\u7565\uff0c\u5982\u679c\u4f60\u53ea\u9700\u8981\u505a\u4e00\u4e9b\u7c21\u55ae\u7684\u529f\u80fd\u3002\u6216\u8005\u4f60\u4e5f\u53ef\u4ee5\u81ea\u5df1\u505a\u4e00\u500b\u76f8\u95dc\u63d2\u4ef6\u53d6\u4ee3\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u91cd\u8981\u7684 module \u5305\u542b\uff1a"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"prosemirror-model\n\u5b9a\u7fa9\u7528\u4f86\u63cf\u8ff0\u7de8\u8f2f\u5668\u5167\u5bb9\u7684\u6587\u4ef6\u6a21\u578b\uff0c\u662f state \u7684\u4e00\u90e8\u5206\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"prosemirror-state\n\u63d0\u4f9b\u63cf\u8ff0\u6574\u500b\u7de8\u8f2f\u5668\u72c0\u614b\u7684\u8cc7\u6599\u7d50\u69cb\uff0c\u5305\u62ec\u9078\u53d6\u7bc4\u570d\u8207\u72c0\u614b\u6539\u8b8a\u7684\u8b8a\u66f4\u6a5f\u5236\uff08transaction system\uff09\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"prosemirror-view\n\u5be6\u73fe\u4e86\u53ef\u4ee5\u986f\u793a editor state \u7684 ui \u4ecb\u9762\uff0c\u4f7f\u7528 html editable element\uff0c\u4e26\u8655\u7406\u4f7f\u7528\u8005\u4e92\u52d5\u3002"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"prosemirror-transform\n\u63d0\u4f9b\u53ef\u4ee5\u4fee\u6539 document \u7684\u529f\u80fd\uff0c\u4e26\u4e14\u53ef\u4ee5\u88ab\u7d00\u9304\u8207\u91cd\u8907\uff0c\u9019\u662f state module \u7684 transaction system \u7684\u57fa\u790e\uff0c\u4e5f\u662f\u6709\u9019\u4e9b\u529f\u80fd\uff0c\u4f7f\u5354\u4f5c\u529f\u80fd\u3001\u5fa9\u539f\u529f\u80fd\u53ef\u4ee5\u5be6\u73fe"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"transactions",children:"transactions"}),"\n",(0,s.jsx)(n.p,{children:"\u7576\u4f7f\u7528\u8005\u8207 view \u4e92\u52d5\u6642\uff0c\u6703\u7522\u751f state transaction\uff0c\u4ee3\u8868\u5728\u66f4\u6539 state \u6642\uff0c\u4e26\u4e0d\u662f\u5728\u5167\u90e8\u66f4\u6539 document \u7684\u72c0\u614b\uff0c\u800c\u662f\u5c07\u6bcf\u500b\u6539\u8b8a\u90fd create \u4e00\u500b transaction\u3002transaction \u5c31\u662f\u63cf\u8ff0\u8207\u539f state \u7684\u5dee\u7570\uff0c\u53ef\u4ee5\u88ab state apply \u6210\u4e00\u500b\u65b0\u7684 state\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u9810\u8a2d\u7684\u4e0a\u8ff0\u7684\u6a5f\u5236\u90fd\u767c\u751f\u5728\u5e55\u5f8c\u3002\u53ef\u4ee5\u5beb ",(0,s.jsx)(n.strong,{children:"plugin"})," \u6216\u662f ",(0,s.jsx)(n.strong,{children:"\u8a2d\u5b9a\u81ea\u5df1\u7684 view"})," \u4f86 hook\u3002\n\u4f8b\u5982\uff1adispatchTransaction\uff0c\u662f EditorView  \u53ef\u50b3\u5165\u7684\u53c3\u6578\uff0cdispatchTransaction \u662f\u4e00\u500b callback\uff0c\u5728 transaction \u88ab\u5275\u5efa\u6642\u89f8\u767c\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u6bcf\u4e00\u6b21 state \u7684\u66f4\u65b0\uff0c\u90fd\u900f\u904e EditorView.updateState\uff0c\u6bcf\u4e00\u500b\u7de8\u8f2f\u66f4\u65b0\u90fd\u7531 dispatch transaction \u89f8\u767c\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"plugins",children:"plugins"}),"\n",(0,s.jsx)(n.p,{children:"plugin \u900f\u904e\u4e0d\u540c\u7684\u65b9\u5f0f\u4f86\u64f4\u5145\u7de8\u8f2f\u5668\u8207\u7de8\u8f2f\u5668\u72c0\u614b\u3002\u6709\u4e9b\u7279\u5225\u7c21\u55ae\uff0c\u50cf\u662f keymap plugin\u3002\u6709\u4e9b\u5247\u662f\u6d89\u5165\u8f03\u591a\uff0c\u50cf\u662f history plugin\u3002\u56e0\u70ba plugin \u5728\u5275\u7acb state \u6642\u8a3b\u518a\uff0c\u56e0\u70ba plugin \u53ef\u4ee5\u53d6\u5f97 state transaction\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"commands",children:"commands"}),"\n",(0,s.jsx)(n.p,{children:"\u5927\u90e8\u5206\u7684\u7de8\u8f2f\u52d5\u4f5c\u90fd\u662f\u4e00\u500b command\u3002\nprosemirror command \u63d0\u4f9b\u4e00\u7cfb\u5217\u57fa\u672c\u7684\u7de8\u8f2f command\uff0c\u4e5f\u5305\u542b\u4e00\u4e9b\u57fa\u672c\u7684\u64cd\u4f5c\u529f\u80fd\u5305\uff08baseKeymap\uff09\uff0c\u50cf\u662f delete, enter \u7b49\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"content",children:"content"}),"\n",(0,s.jsx)(n.p,{children:"\u6574\u500b\u7de8\u8f2f\u5668\u7684 document state \u662f\u5b58\u5728 EditorState.doc \u88e1\u3002\u9019\u662f\u4e00\u500b\u552f\u8b80\u7684\u8cc7\u6599\u7d50\u69cb\uff0c\u7528\u591a\u5c64\u7d1a\u7684 node \u8868\u793a document\uff0c\u985e\u4f3c\u65bc DOM \u7d50\u69cb\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"documents",children:"Documents"}),"\n",(0,s.jsx)(n.h3,{id:"structure",children:"Structure"}),"\n",(0,s.jsx)(n.p,{children:"PM document \u662f\u4e00\u500b class Node\u3002\nclass Node \u6709 property content \u662f class Fragment\n\u800c Fragment \u6709 property content \u662f [NODE]"}),"\n",(0,s.jsx)(n.p,{children:"Fragment \u662f\u4ee3\u8868 \u5b50 node \u7684\u96c6\u5408"}),"\n",(0,s.jsx)(n.p,{children:"node \u8207 fragment \u90fd\u662f persistent \u7684\u7279\u6027\u3002\u9019\u610f\u5473\u8457\u6211\u5011\u4e0d\u8a72 mutate \u5b83\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u662f\u9019\u6a23\u4e00\u6bb5 html\n",(0,s.jsx)(n.code,{children:"<p>This is <strong>strong text with <em>emphasis</em> </strong></p>"}),"\n\u5728 DOM Tree \u88e1\u6982\u5ff5\u4e0a\u662f\u9019\u6a23"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js=",children:"{\n    type: 'p',\n    content: [\n        {\n            type: 'text',\n            text: 'This is',\n        },\n        {\n            type: 'strong',\n            content: [\n                {\n                    type: 'text',\n                    text: 'strong text with'\n                },\n                {\n                    type: 'em',\n                    content: [\n                        {\n                            type: 'text',\n                            text: 'emphasis'\n                        }\n                    ]\n                }\n            ]\n        }\n    ]\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u4f46\u5728 ProseMirror \u6982\u5ff5\u662f\u9019\u6a23"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js=",children:"{\n    type: 'p',\n    content: [\n        {\n            type: 'text',\n            text: 'This is',\n        },\n        {\n            type: 'text',\n            text: 'strong text with',\n            mark: [{ type: 'strong' }]\n        },\n        {\n            type: 'text',\n            text: 'emphasis',\n            mark: [{ type: 'strong' }, { type: 'em' }]\n        },\n    ]\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6240\u4ee5\u5be6\u969b\u4e0a\uff0cProseMirror \u628a inline \u5143\u7d20 flatten \u4e86\uff0cProseMirror document \u5be6\u969b\u4e0a\u662f block \u5143\u7d20\u7684\u6a39\u72c0\u7d50\u69cb\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u9019\u66f4\u7b26\u5408\u6211\u5011\u50be\u5411\u65bc\u601d\u8003\u548c\u8655\u7406\u6b64\u985e\u6587\u672c\u7684\u65b9\u5f0f\u3002\u5b83\u5141\u8a31\u6211\u5011\u4f7f\u7528\u5b57\u5143\u504f\u79fb\u91cf\u800c\u4e0d\u662f\u6a39\u4e2d\u7684\u8def\u5f91\u4f86\u8868\u793a\u6bb5\u843d\u4e2d\u7684\u4f4d\u7f6e\uff0c\u4e26\u4e14\u53ef\u4ee5\u66f4\u8f15\u9b06\u5730\u57f7\u884c\u62c6\u5206\u6216\u66f4\u6539\u5167\u5bb9\u6a23\u5f0f\u7b49\u64cd\u4f5c\uff0c\u800c\u7121\u9700\u57f7\u884c\u7b28\u62d9\u7684\u6a39\u64cd\u4f5c\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"document-transformations",children:"Document transformations"}),"\n",(0,s.jsx)(n.h3,{id:"steps",children:"steps"}),"\n",(0,s.jsxs)(n.p,{children:["\u66f4\u65b0 docuement \u9019\u500b\u884c\u70ba\uff0c\u53ef\u4ee5\u5206\u89e3\u6210\u591a\u500b ",(0,s.jsx)(n.code,{children:"step"}),"\uff0c\u901a\u5e38\u4e0d\u9700\u8981\u76f4\u63a5\u7528\u5230 ",(0,s.jsx)(n.code,{children:"step"}),"\uff0c\u4f46\u77e5\u9053\u5982\u4f55\u5be6\u4f5c\u662f\u6709\u7528\u7684\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["steps \u7684\u4f8b\u5b50\uff1a\u7528 ",(0,s.jsx)(n.code,{children:"replaceStep"})," \u53d6\u4ee3 document \u4e2d\u7684\u4e00\u584a\u3002\nstep \u53ef\u4ee5\u88ab apply \u9032 document\uff0c\u5efa\u7acb\u4e00\u500b\u65b0\u7684 document"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js=",children:"console.log(myDoc.toString()); // p('hello');\n// A step that deletes the content between position 3 and 5\nlet step = new ReplaceStep(3, 5, Slice.empty);\nlet result = step.apply(mydoc);\nconsole.log(result.doc.toString()); // p('heo')\n"})}),"\n",(0,s.jsxs)(n.p,{children:["apply step \u662f\u4e00\u500b\u76f8\u5c0d\u76f4\u89c0\u7684\u884c\u70ba\uff0c\u610f\u601d\u662f\uff0c\u662f\u6709\u53ef\u80fd\u6703\u5831\u932f\u7684\u3002\u4f8b\u5982\uff1a\u5982\u679c\u5617\u8a66\u522a\u9664 opening token\uff08",(0,s.jsx)(n.code,{children:"<p>"})," \u6a19\u7c64\uff09\uff0c\u53ef\u80fd\u6703\u5c0e\u81f4 token \u4e0d\u5e73\u8861\u3002\u9019\u4e5f\u662f\u70ba\u4ec0\u9ebc apply \u6703\u56de\u50b3\u4e00\u500b result object\u3002result \u6703\u5728\u6210\u529f\u6642\u56de\u50b3 doc\uff0c\u5931\u6557\u6642\u56de\u50b3 error message\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u901a\u5e38\u6703\u7fd2\u6163\u4f7f\u7528 Transform \u63d0\u4f9b\u7684\u4e00\u7cfb\u5217 helper function \u8655\u7406 step\uff0c\u9019\u6a23\u5c31\u4e0d\u7528\u9867\u616e\u592a\u591a\u7d30\u7bc0\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"transform",children:"Transform"}),"\n",(0,s.jsx)(n.p,{children:"\u4e00\u500b\u7de8\u8f2f\u52d5\u4f5c\uff0c\u53ef\u80fd\u6703\u7522\u751f\u4e00\u500b\u6216\u591a\u500b step\u3002\n\u5982\u679c\u8981\u64cd\u4f5c\u4e00\u7cfb\u5217\u7684 step\uff0c\u6700\u65b9\u4fbf\u7684\u65b9\u5f0f\u662f\u4f7f\u7528 Transform\u3002"}),"\n",(0,s.jsx)(n.p,{children:"Transform \u9019\u500b class \u5c31\u662f\u7528\u4f86\u5efa\u7acb\u8207\u8ffd\u8e64\u4e00\u7cfb\u5217 step \u7684\u62bd\u8c61"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js=",children:"let tr = new Transform(myDoc);\ntr.delete(5, 7); // delete between position 5 and 7\ntr.split(5); // split the parent node at position 5\n\nconsole.log(tr.doc.toString()); // The modeified document\nconsole.log(tr.steps.length); // 2\n"})}),"\n",(0,s.jsxs)(n.p,{children:["transform \u5927\u90e8\u5206\u7684 method \u90fd\u6703\u56de\u50b3\u81ea\u5df1\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5\u628a\u65b9\u6cd5 chain \u8d77\u4f86\u3002\n",(0,s.jsx)(n.code,{children:"tr.delete(5, 7).split(5)"})]}),"\n",(0,s.jsx)(n.h3,{id:"mapping",children:"Mapping"}),"\n",(0,s.jsx)(n.p,{children:"\u7576\u6539\u8b8a document\uff0c\u6bcf\u500b postion index \u5176\u5be6\u4e5f\u6703\u6539\u8b8a\u3002\u4f8b\u5982\u63d2\u5165\u4e00\u500b\u5b57\u5143\u6216\u662f\u522a\u9664\u5b57\u5143\uff0c\u90fd\u6703\u5c0e\u81f4\u6574\u500b doc \u7684 index \u8207\u4e4b\u524d\u4e0d\u4e00\u6a23\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u901a\u5e38\u6703\u9700\u8981\u5728\u6587\u5b57\u7684\u8b8a\u66f4\u4e2d\uff0c\u4fdd\u7559\u4f4d\u7f6e\u3002ex: selection boundaries\u3002\n\u70ba\u4e86\u9019\u500b\u9700\u6c42\uff0cproseMirror \u7684 step \u63d0\u4f9b ",(0,s.jsx)(n.a,{href:"https://prosemirror.net/docs/ref/#transform.StepMap",children:"map"}),"\uff0c\n\u53ef\u4ee5\u900f\u904e\u6bd4\u8f03\u6539\u8b8a\u524d\u5f8c\u7684 index \u8b8a\u5316\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js=",children:"let step = new ReplaceStep(4, 6, Slice.empty); // delete 4-5\nlet map = step.getMap();\nconsole.log(map.map(8));  // -> 6 (\u539f\u672c\u662f 8 \u8b8a\u6210 6)\nconsole.log(map.map(2)); // -> 2 (\u539f\u672c\u662f 2 \u4e0d\u8b8a)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Tramsform \u6709 mapping \u9019\u500b property \u7d00\u9304\u4e86\u4e00\u7cfb\u5217 steps \u7684 maps\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js=",children:"let tr = new Transform(myDoc);\ntr.split(10) // split a node, +2 tokens at 10\ntr.delete(2, 5) // -3 tokens at 2\n\nconsole.log(tr.mapping.map(15)) // -> 14\nconsole.log(tr.mapping.map(6)) // -> 3\nconsole.log(tr.mapping.map(10)) // -> 9\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u67d0\u4e9b\u6642\u5019\uff0c\u4e26\u4e0d\u662f\u5f88\u6e05\u695a\u539f\u59cb\u7684 index \u8981 map \u5230\u54ea\u4e00\u500b\u4f4d\u7f6e\u3002\u4f8b\u5982\uff1a\u524d\u9762\u4f8b\u5b50 index 10\uff0c\u7a76\u7adf\u61c9\u8a72\u628a 10 \u653e\u5728\u5206\u5272\u7684\u5f8c\u9762\u6216\u8005\u662f\u524d\u9762\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u5176\u5be6 index 10 \u61c9\u8a72\u5728\u524d\u9762\uff0c\u53ef\u4ee5\u9019\u6a23\u505a ",(0,s.jsx)(n.code,{children:"tr.mapping.map(10, -1)"})]}),"\n",(0,s.jsx)(n.p,{children:"\u5c07\u5404\u7a2e step \u5b9a\u7fa9\u7684\u5c0f\u800c\u76f4\u89c0\u7684\u539f\u56e0\u662f\uff0c\u8b93\u9019\u6a23\u5b50\u7684 mapping \u7d00\u9304\u53ef\u4ee5\u5be6\u73fe\u3002\u751a\u81f3\u53ef\u4ee5\u53cd\u8f49 step\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"rebasing",children:"Rebasing"}),"\n",(0,s.jsx)(n.p,{children:"\u7576\u900f\u904e step \u6216\u662f position map \u5be6\u4f5c\u8f03\u8907\u96dc\u7684\u884c\u70ba\uff0c\u4f8b\u5982\uff1a\u8ffd\u8e64\u8b8a\u66f4\u7d00\u9304\uff0c\u6216\u662f\u5728\u591a\u4eba\u5354\u4f5c\u4e2d\u589e\u52a0\u5176\u4ed6\u529f\u80fd\uff0c\u53ef\u80fd\u6703\u4f7f\u7528\u5230 rebase steps\u3002"}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"\u592a\u62bd\u8c61\u4e86\uff0c\u6709\u5be6\u4f5c\u9019\u6bb5\uff0c\u518d\u4f86\u8aaa\u660e"})}),"\n",(0,s.jsx)(n.h2,{id:"the-editor-state",children:"The editor state"}),"\n",(0,s.jsx)(n.p,{children:"\u7de8\u8f2f\u5668\u8981\u8a18\u5f97\u72c0\u614b\u6709\u54ea\u4e9b\uff0c\u5982\u4f55\u6587\u7ae0\u7684\u8cc7\u6599\u7d50\u69cb\uff08document\uff09\u5916\uff0c\u9084\u6709 current selection\u3001\u76ee\u524d mark \u7684\u72c0\u614b\u3002\nProseMirror state \u6709 3 \u500b\u4e3b\u8981\u7684\u72c0\u614b\u5c31\u662f doc, selection, storeMarks\u3002"}),"\n",(0,s.jsx)(n.p,{children:"plugin \u4e5f\u9700\u8981\u5132\u5b58 state\u3002undo history \u4e5f\u9700\u8981\u8a18\u5f97\u6b77\u53f2\u7d00\u9304\u3002\u9019\u5c31\u662f\u70ba\u4ec0\u9ebc editorState \u88e1\uff0c\u4e5f\u6709\u5132\u5b58\u76ee\u524d active \u7684 plugin\u3002\u9019\u4e9b plugin \u4e5f\u53ef\u4ee5\u5132\u5b58 plugin \u81ea\u5df1\u7684 state\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"selection",children:"Selection"}),"\n",(0,s.jsx)(n.p,{children:"PM \u652f\u63f4\u591a\u7a2e\u4e0d\u540c\u7684 selection\u3002\u6240\u6709\u7684 selection \u90fd\u662f\u7e7c\u627f Class Selection \u7684\u5be6\u4f8b\u3002editor state \u88e1\u7684 selection \u4e5f\u662f immutable \u7684\uff0c\u8981\u6539\u8b8a selection\uff0c\u8981\u5efa\u4e00\u500b\u65b0\u7684 selection object\uff0c\u8207\u4e00\u500b\u65b0\u7684 state\u3002"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:".from"}),"\uff1aselection \u7576\u4e2d\uff0c\u6587\u672c\u524d\u7aef\u7684\u90a3\u500b point\n",(0,s.jsx)(n.code,{children:".to"}),"\uff1aselection \u7576\u4e2d\uff0c\u6587\u672c\u5f8c\u7aef\u7684\u90a3\u500b point\n",(0,s.jsx)(n.code,{children:".anchor"}),"\uff1aselection \u7576\u4e2d\uff0c\u4e00\u958b\u59cb\u91d8\u4e0b\u7684 point\uff0c\u4e0d\u6703\u52d5\u7684\u90a3\u500b point\n",(0,s.jsx)(n.code,{children:".head"}),"\uff1aselection \u7576\u4e2d\uff0c\u5728\u79fb\u52d5\u7684 point"]}),"\n",(0,s.jsx)(n.h3,{id:"transaction",children:"Transaction"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u4e00\u822c\u6b63\u5e38\u7de8\u8f2f\u7684\u6642\u5019\uff0cnewState \u6703\u6839\u64da\u820a\u7684 state \u7522\u751f\u3002"}),"\n",(0,s.jsx)(n.p,{children:"state \u53ef\u4ee5 apply transaction \u4f86\u7522\u751f\u65b0\u7684 state\u3002"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Transaction"})," \u7e7c\u627f\u81ea ",(0,s.jsx)(n.code,{children:"Transform"}),"\uff0ctransaction \u6703\u8ffd\u8e64 selection \u8207\u5176\u4ed6\u6709\u72c0\u614b\u7684\u5143\u4ef6\uff0cTransaction \u5be6\u969b\u4e0a\u88ab\u6b78\u985e\u5728 prosemirror-state\uff0c\u50cf\u662f store marks \u7684\u6539\u8b8a\uff0c\u4e5f\u6703\u8ffd\u8e64\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u6211\u89ba\u5f97\u53ef\u4ee5\u8aaa Transaction \u662f\u91dd\u5c0d\u7de8\u8f2f\u5668\u6709\u52a0\u4e0a\u4e86\u4e00\u4e9b\u7279\u5316\u529f\u80fd\u7684 Transform\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u6240\u4ee5 Transaction \u6709\u4e00\u7cfb\u5217\u4fee\u8a72\u7de8\u8f2f\u5668\u76f8\u95dc\u72c0\u614b\u7684 method\u3002",(0,s.jsx)(n.code,{children:"setStoreMarks"}),"\u3001",(0,s.jsx)(n.code,{children:"ensureMarks"}),"\u3001",(0,s.jsx)(n.code,{children:"scrollIntoView"}),"...\u7b49\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"plugins-1",children:"Plugins"}),"\n",(0,s.jsx)(n.p,{children:"\u7576\u5efa\u4e00\u500b\u65b0\u7684 editorState \u6642\uff0c\u53ef\u4ee5\u5e36\u5165\u4e00\u500b array \u8a2d\u5b9a\u4e00\u7cfb\u5217\u7684 plugin\u3002\u9019\u4e9b plugin \u6703\u88ab\u5b58\u5728 state \u88e1\u9762\uff0c\u4e26\u4e14\u53ef\u4ee5\u5728 plugin \u88e1 apply transaction\uff0c\u6216\u5f71\u97ff editor \u8655\u7406 state \u7684\u884c\u70ba\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js=",children:"let myPlugin = new Plugin({\n    props: {\n        handleKeyDown(view, event) {\n            console.log('A key was pressed');\n            return false; // We did not handle this\n        }\n    }\n});\n\nlet state = EditorState.create({ schema, plugins: [myPlugin] });\n"})}),"\n",(0,s.jsx)(n.p,{children:"plugin \u4e5f\u53ef\u4ee5\u5b9a\u7fa9\u81ea\u5df1\u7684 state\n\u6240\u4ee5\u5176\u5be6 PM \u6709\u5206\u6709 state \u7684 plugin \u548c\u6c92\u6709 state \u7684 plugin\u3002\n\u6709 state \u7684 plugin \u4e00\u5b9a\u8981\u653e\u5728 EditorState \u88ab\u5efa\u7acb\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js=",children:"let transactionCounter = new Plugin({\n    state: {\n        init() { return 0 },\n        apply(tr, value) { return value + 1 }\n    }\n})\n\nfunction getTransactionCount(state) {\n    transactionCounter.getState(state);\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"getState \u6703\u5f9e\u6574\u500b editorState \u4e2d\u63d0\u53d6 plugin \u7684 state\u3002\n\u6574\u500b editor state \u662f immutable \u7684\uff0c\u6240\u4ee5 apply method \u9700\u56de\u50b3\u4e00\u500b\u65b0\u503c\u3002"}),"\n",(0,s.jsx)(n.h4,{id:"metadata",children:"metadata"}),"\n",(0,s.jsxs)(n.p,{children:["metadata \u4e3b\u8981\u7528\u65bc\u5c0d plugin \u5728 apply \u65b0\u7684 state \u6642\uff0c\u52a0\u4e0a\u4e00\u4e9b\u8cc7\u8a0a\u3002\nmetadata \u7684\u76f8\u95dc method \u662f\u900f\u904e transaction \u8655\u7406\u7684\u3002\u6709 ",(0,s.jsx)(n.code,{children:"tr.getMeta()"}),"\uff0c",(0,s.jsx)(n.code,{children:"tr.setMeta()"}),"\uff0c\n\u4e5f\u5c31\u662f\u6703\u6a19\u8a18\u8a72 transaction \u7684\u72c0\u614b\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u4f8b\u5982\uff1aundo history plugin\uff0c\u5728\u9032\u884c \u57f7\u884c undo \u6642\uff0c\u6703\u6a19\u8a18\u8a72 transaction\uff0c\u7576 plugin \u767c\u73fe\u9019\u500b transaction \u6709\u88ab\u6a19\u8a18\u6642\uff0c\u6709\u5225\u65bc\u4e00\u822c\u7684\u7d00\u9304\u66f4\u65b0\uff08\u628a transaction \u52a0\u5230 undo stack\uff09\uff0cplugin \u6703\u5c07 undo stack \u6700\u4e0a\u9762\u7684 transaction \u642c\u79fb\u5230 redo stack\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u800c\u70ba\u4e86\u8b93 plugin \u80fd\u5920\u5224\u65b7\u4e0d\u540c\u60c5\u6cc1\uff0c\u5c31\u8981\u7528 metadata \u4f86\u8f14\u52a9\u3002\u4f8b\u5982\u4e0a\u9762\u7684 transactionCounter\uff0c\u5982\u679c\u6709\u7279\u6b8a\u7684\u60c5\u5883\u8981\u8b93 count \u4e0d +1 \u7684\u8a71\u3002\u53ef\u4ee5\u9019\u6a23\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js=",children:"let transactionCounter = new Plugin({\n    state: {\n        init() { return 0 },\n        apply(tr, value) {\n            if (tr.getMeta(transactionCounter)) {\n                return value;\n            }\n            return value + 1;\n        }\n    }\n})\n\nfunction markAsUncounted(tr) {\n    tr.setMeta(transactionCounter, true);\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"setMeta \u7684 type \u5b9a\u7fa9\uff0c\u5be6\u969b\u4e0a value \u53ef\u4ee5\u662f any\nsetMeta \u7684 key \u63a8\u85a6\u4f7f\u7528 Plugin \u672c\u8eab\uff0c\u5982\u679c\u8981 string \u7684\u8a71\uff0c\u5c31\u8981\u78ba\u4fdd\u5176\u552f\u4e00\u6027\u3002\n\u6709\u4e9b PM \u7684\u63d2\u4ef6\u88e1\u9762\uff0c\u6709\u7528 string \u7576\u4f5c key\u3002"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts=",children:"function setMeta(\n    key: string | Plugin | PluginKey\n    value: any\n): Transaction\n"})}),"\n",(0,s.jsx)(n.h2,{id:"the-view-component",children:"The View Component"}),"\n",(0,s.jsx)(n.p,{children:"PM editor view \u662f\u7528\u4f86\u8f49\u63db editor state \u81f3 DOM \u7684\u5143\u4ef6\u3002\u4e26\u5141\u8a31\u4f7f\u7528\u8005\u9032\u884c\u4e00\u4e9b\u7de8\u8f2f(editing actions)\u3002"}),"\n",(0,s.jsx)(n.p,{children:"EditorView \u5143\u4ef6\u5c0d\u65bc editing actions \u7684\u5b9a\u7fa9\u662f\u56b4\u8b39\u7684\u3002\u4e3b\u8981\u70ba\u76f4\u63a5\u5c0d\u7de8\u8f2f\u5668\u7684\u64cd\u4f5c\uff0c\u50cf\u662f typing, clicking, copying, pasting, dragging\uff0c\u4e0d\u8d85\u904e\u4ee5\u4e0a\u7bc4\u570d\u3002\u56e0\u6b64\u50cf\u662f\uff0cmenu\uff0c\u5feb\u6377\u9375\u884c\u70ba\u7d81\u5b9a\u7b49\u529f\u80fd\uff0c\u4e26\u4e0d\u5c6c\u65bc EditorView \u5143\u4ef6\u7684\u8077\u8cac\u7bc4\u570d\uff0c\u9700\u8981\u900f\u904e plugin \u4f86\u5be6\u73fe\u3002"}),"\n",(0,s.jsx)(n.p,{children:"Browser \u900f\u904e contentEditable \u53ef\u4ee5\u8b93 DOM \u5143\u7d20\u88ab\u7de8\u8f2f\uff0c\u8b93\u5143\u7d20\u53ef\u4ee5\u88ab focus \u8207 select\uff0c\u4e5f\u53ef\u4ee5\u5728\u5176\u4e2d\u8f38\u5165\u5167\u5bb9\u3002View \u5c07 PM document \u8f49\u63db\u70ba DOM\uff0c\u4e26\u4e14\u8b93 DOM \u7684\u7de8\u8f2f\u4e5f\u9023\u52d5\u5230 editor state \u4e0a(ex: selection...)\u3002"}),"\n",(0,s.jsx)(n.p,{children:"EditorView \u672c\u8eab\u4e5f\u8a3b\u518a\u4e86\u8a31\u591a DOM events\uff0c\u4e26\u5c07\u9019\u4e9b event \u8f49\u63db\u70ba\u9069\u7576\u7684 transaction\u3002\u4f8b\u5982\uff1a\u8cbc\u4e0a\u9019\u500b\u884c\u70ba\uff0c\u88ab\u8cbc\u4e0a\u7684\u5167\u5bb9\u6703\u88ab\u8f49\u63db\u70ba ProseMirror document Slice\uff0c\u4e26\u88ab\u63d2\u5165 document \u4e2d\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u8a31\u591a\u4e8b\u4ef6\u4e5f\u88ab\u539f\u6a23\u50b3\u905e\uff0c\u7136\u5f8c\u624d\u8ddf\u8457 PM \u7684\u8cc7\u6599\u6a21\u578b\u88ab\u91cd\u65b0\u89e3\u91cb\u3002Browser \u5c0d\u65bc cursor \u8207 selection \u7684\u884c\u70ba\u5341\u5206\u5728\u884c\u3002\u6240\u4ee5\u5927\u90e8\u5206 cursor \u7684\u52d5\u4f5c\u90fd\u88ab browser \u8655\u7406\uff0c\u5728\u8655\u7406\u5b8c\u5f8c\uff0cPM \u624d\u53bb\u6aa2\u67e5\u76ee\u524d\u7684 DOM selection \u662f\u5426\u7b26\u5408\u5230 PM \u7684 text selection\u3002\u5047\u82e5\u4e0d\u7b26\u5408\uff0c\u4fbf\u6703 dispatch \u95dc\u65bc selection \u7684 transaction\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u4e00\u822c\u7684\u6253\u5b57\uff0c\u4e5f\u662f\u7559\u7d66 browser \u8655\u7406\uff0c\u56e0\u70ba\u5e72\u64fe\u6253\u5b57\u53ef\u80fd\u6703\u7834\u58de\u700f\u89bd\u5668\u63d0\u4f9b\u7684\u539f\u59cb\u529f\u80fd\uff0c\u4f8b\uff1a\u62fc\u5b57\u6aa2\u67e5\u3001\u81ea\u52d5\u88dc\u5168...\u7b49\u3002editorView \u6703\u76e3\u807d browser \u7684 dom \u5167\u5bb9\u6539\u8b8a\u5f8c\uff0cparse \u76ee\u524d\u7684\u7d50\u69cb\uff0c\u4e26\u751f\u6210\u53ef\u4ee5\u63d0\u4f9b\u4fee\u8a02\u539f\u59cb state \u7684 transaction\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"data-flow",children:"Data flow"}),"\n",(0,s.jsxs)(n.p,{children:["\u6240\u4ee5 editorview \u5c07\u7d66\u5b9a\u7684 editor state \u986f\u793a\u51fa\u4f86\u3002\u7576 DOM event \u89f8\u767c\u6642\uff0ceditorview \u5efa\u7acb transaction\uff0c\u4e26\u4e14\u53ef\u4ee5\u900f\u904e apply tr \u5efa\u7acb\u4e00\u500b\u65b0\u7684 state\uff0c\u6700\u5f8c\u5c07\u65b0\u7684 state \u7d66 view \u57f7\u884c ",(0,s.jsx)(n.code,{children:"updateState(state)"})]}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u4e0a\u5716\u662f\u5176\u8cc7\u6599\u6d41\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"props",children:"Props"}),"\n",(0,s.jsx)(n.p,{children:"props \u53ef\u4ee5\u7406\u89e3\u70ba react props\u3002\u5c31\u662f ui component \u7684\u53c3\u6578\u3002\nstate \u4e5f\u662f\u4e00\u500b prop\u3002\u6240\u6709\u5176\u4ed6\u7684 props \u5728\u904b\u884c\u6642\u90fd\u53ef\u4ee5\u88ab\u66f4\u65b0\u3002\nPlugin \u4e5f\u53ef\u4ee5\u5e36\u5165 props\uff0c\u5982\u679c props \u88ab\u5b9a\u7fa9\u4e86\u591a\u6b21\uff08\u53ef\u4ee5\u5f9e EditorView \u6216 Plugin \u5b9a\u7fa9 props\uff09\uff0c\u4e00\u822c\u4f86\u8aaa\uff0c\u6703\u6309\u9806\u5e8f\u78ba\u5b9a props \u7684\u503c\u70ba\u4f55\uff0c\u4f9d\u5e8f\u57f7\u884c\u3002EditorView \u70ba\u6700\u5148\u7684\uff0c\u5176\u6b21\u4f9d\u64da plugin \u7684\u9806\u5e8f\u57f7\u884c\u3002\n\u5982\u679c\u662f handler function\uff0c\u6703\u4e00\u76f4\u57f7\u884c\u76f4\u5230 return true \u7684\u90a3\u4e00\u500b\u70ba\u6b62\u3002\n\u5c0d\u65bc\u4e00\u4e9b\u53ef\u4ee5\u6709\u591a\u7a2e\u503c\u7684 props\uff0c\u5c31\u6703\u88ab\u805a\u96c6\u8d77\u4f86\u3002\uff08ex\uff1aattribue, decoration)"}),"\n",(0,s.jsx)(n.h3,{id:"decorations",children:"Decorations"}),"\n",(0,s.jsx)(n.p,{children:"Decoration \u8b93\u4f60\u53ef\u4ee5\u63a7\u5236 view \u5982\u4f55\u986f\u793a\u6587\u672c\u3002\u4f46 Decoration \u4e0d\u6703\u5728 document \u4e2d\u63d2\u5165 node\uff0c\u800c\u662f\u6709\u81ea\u5df1\u7684 tree \u7d50\u69cb\u3002\nDecoration \u5206\u6210 3 \u7a2e\uff1a"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Node Decoration\uff1a\u5c0d\u4e00\u500b node DOM \u52a0\u4e0a style \u6216 attribute"}),"\n",(0,s.jsx)(n.li,{children:"Widget Decoration\uff1a\u5728\u7d66\u5b9a position \u63d2\u5165\u4e00\u500b DOM node\uff0c\u9019\u4e26\u4e0d\u5728 document \u4e2d\u3002"}),"\n",(0,s.jsx)(n.li,{children:"Inline Decoration\uff1a\u985e\u4f3c Node Decoration\uff0c\u4f46\u4f5c\u7528\u5728 inline node \u4e0a\u3002"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u70ba\u4e86\u8981\u6709\u6548\u7387\u7684\u7e6a\u88fd\u8207\u6bd4\u5c0d decorations\uff0c\u9700\u8981\u900f\u904e decotation set \u52a0\u5165 decoration\u3002\ndecotation set \u662f\u4e00\u500b Tree \u7684 \u8cc7\u6599\u7d50\u69cb"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js=",children:"let purplePlugin = new Plugin({\n    props: {\n        decorations(state) {\n            return DecorationSet.create(state.doc, [\n                Decoration.inline(0, state.doc.content.size, { style: 'color: purple' })\n            ])\n        }\n    }\n})\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u6709\u5927\u91cf decoration\uff0c\u6bcf\u6b21\u91cd\u7e6a\u90fd\u8981\u900f\u904e DecorationSet recreate \u5927\u91cf decoration\uff0c\u662f\u8017\u6548\u80fd\u7684\u3002\u91dd\u5c0d\u9019\u7a2e\u60c5\u6cc1\uff0c\u5efa\u8b70\u628a decorationSet \u5beb\u9032 plugin state \u88e1\u3002\u900f\u904e decorationSet.map \u8655\u7406\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"node-view",children:"Node View"}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsx)(n.p,{children:"\u81ea\u5df1\u7684\u7406\u89e3\uff1anode view \u662f\u4e00\u500b\u5167\u5bb9\u53ef\u4ee5\u81ea\u5b9a\u7fa9\u7684\u5143\u4ef6\uff0cnode view \u5fc5\u9808\u8ddf schema \u7684 spec \u642d\u914d\u3002spec \u5b9a\u7fa9\u5916\u9762\u7684 DOM \u7d50\u69cb\u3002node view \u53ef\u4ee5\u5728\u5c0d\u5167\u90e8\u7684\u5167\u5bb9\u505a\u5ba2\u88fd\u529f\u80fd\u3002"}),(0,s.jsx)(n.p,{children:"nodeSpec \u7684 toDOM \u5b9a\u7fa9\u4e86\u5916\u9762\u7684 DOM \u7d50\u69cb\uff0c\u4f8b\uff1a\n['p', 0]\nnode view \u50cf\u662f\u53ef\u4ee5\u7528 js \u8abf\u6574 0 \u88e1\u9762\u7684\u6771\u897f"})]}),"\n",(0,s.jsx)(n.p,{children:"\u5f85\u88dc"}),"\n",(0,s.jsx)(n.h2,{id:"commands-1",children:"commands"}),"\n",(0,s.jsx)(n.p,{children:"\u5728 PM\uff0ccommand \u5c08\u6307\u4e00\u500b\u8853\u8a9e\uff0c\u662f\u5be6\u73fe editor action \u7684 function\u3002"}),"\n",(0,s.jsx)(n.p,{children:"\u6839\u64da\u5be6\u969b\u60c5\u6cc1\uff0ccommand \u53ef\u4ee5\u662f\u4e00\u500b\u8907\u96dc\u7684\u4ecb\u9762\u3002\u5728\u7c21\u55ae\u7684\u60c5\u5f62\u4e0b\uff0ccommand \u662f\u4e00\u500b function \u63a5\u6536 editor state \u8207 dispatch function \u505a\u70ba\u53c3\u6578\uff0c\u4e26\u4e14 return true or false\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u70ba\u4e86\u8981\u77e5\u9053 command \u5728\u7d66\u5b9a\u7684 state \u4e0b\u662f\u5426\u53ef\u4ee5\u57f7\u884c\uff0c\u4f46\u53c8\u5fc5\u9808\u78ba\u4fdd\u5728\u78ba\u5b9a\u53ef\u57f7\u884c\u5f8c\uff0c\u5728\u89f8\u767c dispatch\uff0ccommand \u88ab\u8a2d\u8a08\u6210\uff0c\u5982\u679c\u53c3\u6578",(0,s.jsx)(n.strong,{children:"\u53ea\u6709\u7d66 state"}),"\uff0ccommand \u53ea\u6703 return true or false\uff0c\u4f86\u78ba\u5b9a command \u662f\u5426\u53ef\u57f7\u884c\u3002"]}),"\n",(0,s.jsx)(n.p,{children:"\u4f8b\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js=",children:"function deleteSelection(state, dispatch) {\n    if (state.selection.empty) {\n        return false;\n    }\n    if (dispatch) {\n        dispatch(state.tr.deleteSelection);\n    }\n    return true;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"prosemirror-commands \u6a21\u7d44\u63d0\u4f9b\u4e86\u8a31\u591a editing commands\u3002\u50cf\u662f deleteSelection\u3002\u4e5f\u6709\u8f03\u8907\u96dc\u7684\u50cf\u662f joinBackward\u3002joinBackward \u4e3b\u8981\u662f\u61c9\u7528\u5728 backspace \u9375\u89f8\u767c\u6642\uff0c\u82e5\u5728\u6e38\u6a19\u7f6e\u65bc textblock \u6700\u524d\u65b9\u6642\uff0c\u8981\u5be6\u4f5c 2 \u500b block \u5408\u4f75\u7684\u64cd\u4f5c\u3002"}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"chainCommad \u597d\u96e3\u89e3\u91cb\uff0c\u6709\u6a5f\u6703\u518d\u88dc"})}),"\n",(0,s.jsx)(n.p,{children:"\u6709\u4e9b\u6642\u5019\uff0ccommand \u9700\u8981\u8ddf view \u4e92\u52d5\uff0c\u9019\u6642\u5019 command \u6703\u518d\u591a\u4e00\u500b\u53c3\u6578 view\u3002\n\u6240\u4ee5 command \u5b8c\u6574\u7684 type \u662f\u9019\u6a23"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts=",children:"(\n    state: EditorState,\n    dispatch: (tr: Transaction) => void,\n    view?: EditorView\n) => boolean\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u53c3\u8003\u6587\u7ae0",children:"\u53c3\u8003\u6587\u7ae0"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://prosemirror.net/docs/guide/",children:"https://prosemirror.net/docs/guide/"})})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var s=t(6540);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);